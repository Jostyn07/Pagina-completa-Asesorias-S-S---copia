<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Calidad - S&S Asesorías</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/sidebar.css">
    <link rel="stylesheet" href="../css/control_calidad.css">
</head>
<body>
    <!-- SIDEBAR UNIFICADO -->
    <aside class="sidebar-unified" id="sidebar">
        <div class="sidebar-header">
            <a href="./home.html" class="sidebar-logo-link">
                <img src="../images/Logo.png" alt="S&S Asesorías" class="sidebar-logo-img">
            </a>
            <button class="sidebar-toggle-btn" onclick="toggleSidebar()">
                <span class="material-symbols-rounded">chevron_left</span>
            </button>
        </div>

        <div class="sidebar-search">
            <div class="search-box">
                <span class="material-symbols-rounded">search</span>
                <input type="text" placeholder="Buscar...">
            </div>
        </div>

        <nav class="sidebar-nav">
            <a href="./home.html" class="menu-item">
                <span class="material-symbols-rounded">home</span>
                <span>Inicio</span>
            </a>

            <a href="./polizas.html" class="menu-item">
                <span class="material-symbols-rounded">description</span>
                <span>Pólizas</span>
            </a>

            <a href="#" class="menu-item">
                <span class="material-symbols-rounded">bar_chart</span>
                <span>Gráficos</span>
            </a>

            <a href="#" class="menu-item">
                <span class="material-symbols-rounded">folder</span>
                <span>Gestiones</span>
            </a>

            <a href="#" class="menu-item">
                <span class="material-symbols-rounded">trending_up</span>
                <span>Seguimiento</span>
            </a>

            <a href="#" class="menu-item">
                <span class="material-symbols-rounded">rate_review</span>
                <span>Solicitud de revisión mercado</span>
            </a>

            <a href="./para-revisar.html" class="menu-item">
                <span class="material-symbols-rounded">fact_check</span>
                <span>Para revisar</span>
            </a>

            <a href="./control_calidad.html" class="menu-item active">
                <span class="material-symbols-rounded">verified</span>
                <span>Control de calidad</span>
            </a>

            <a href="./historial_evaluaciones.html" class="menu-item">
                <span class="material-symbols-rounded">history</span>
                <span>Mis Evaluaciones</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="dark-mode-toggle" onclick="toggleDarkMode()">
                <div class="dark-mode-label">
                    <span class="material-symbols-rounded">dark_mode</span>
                    <span>Modo Oscuro</span>
                </div>
                <div class="toggle-switch" id="darkModeSwitch">
                    <div class="toggle-circle"></div>
                </div>
            </div>
        </div>
    </aside>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="main-container">
        <!-- HEADER -->
        <header class="page-header">
            <div class="header-content">
                <div class="header-icon">
                    <i class="fas fa-clipboard-check"></i>
                </div>
                <div class="header-text">
                    <h1>Control de Calidad</h1>
                    <p>Evaluación de ventas y desempeño de asesores</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn-secondary" onclick="window.location.href='./historial_evaluaciones.html'">
                    <i class="fas fa-history"></i>
                    Ver Historial
                </button>
                <button class="btn-secondary" onclick="limpiarFormulario()">
                    <i class="fas fa-redo"></i>
                    Nueva Evaluación
                </button>
            </div>
        </header>

        <!-- INDICADOR DE AUTOGUARDADO -->
        <div class="autosave-indicator" id="autosaveIndicator">
            <i class="fas fa-check-circle"></i>
            <span>Borrador guardado automáticamente</span>
        </div>

        <!-- FORMULARIO DE EVALUACIÓN -->
        <form id="formEvaluacion" class="evaluation-form">
            
            <!-- SECCIÓN 1: INFORMACIÓN BÁSICA -->
            <section class="form-section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="section-title">
                        <h2>Información Básica</h2>
                        <p>Datos generales de la evaluación</p>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label for="fechaEvaluacion">
                            <i class="far fa-calendar"></i>
                            Fecha de Evaluación
                            <span class="required">*</span>
                        </label>
                        <input type="date" id="fechaEvaluacion" name="evaluationDate" required>
                    </div>

                    <div class="form-group">
                        <label for="evaluador">
                            <i class="far fa-user"></i>
                            Evaluador
                            <span class="required">*</span>
                        </label>
                        <input type="text" id="evaluador" name="evaluator" placeholder="Nombre del evaluador" required>
                    </div>

                    <div class="form-group">
                        <label for="asesorNombre">
                            <i class="fas fa-user-tie"></i>
                            Nombre del Asesor
                            <span class="required">*</span>
                        </label>
                        <input type="text" id="asesorNombre" name="advisorName" placeholder="Nombre completo" required>
                    </div>

                    <div class="form-group">
                        <label for="asesorId">
                            <i class="fas fa-id-card"></i>
                            ID del Asesor
                        </label>
                        <input type="text" id="asesorId" name="advisorId" placeholder="ID o código">
                    </div>

                    <div class="form-group">
                        <label for="clienteIdVenta">
                            <i class="fas fa-receipt"></i>
                            ID Cliente/Venta
                        </label>
                        <input type="text" id="clienteIdVenta" name="clientSaleId" placeholder="Ej: CLI-12345">
                    </div>

                    <div class="form-group">
                        <label for="canal">
                            <i class="fas fa-phone"></i>
                            Canal
                            <span class="required">*</span>
                        </label>
                        <select id="canal" name="channel" required>
                            <option value="">Seleccionar canal...</option>
                            <option value="Teléfono">Teléfono</option>
                            <option value="Chat">Chat</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="duracionAudio">
                            <i class="far fa-clock"></i>
                            Duración del Audio
                        </label>
                        <input type="text" id="duracionAudio" name="audioDuration" placeholder="Ej: 05:30">
                        <small>Formato: MM:SS</small>
                    </div>
                </div>
            </section>

            <!-- SECCIÓN 2: RESULTADO DE LA EVALUACIÓN -->
            <section class="form-section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                    <div class="section-title">
                        <h2>Resultado de la Evaluación</h2>
                        <p>Decisión sobre la venta evaluada</p>
                    </div>
                </div>

                <div class="result-options">
                    <label class="result-option approved">
                        <input type="radio" name="result" value="approved" required>
                        <div class="result-content">
                            <i class="fas fa-check-circle"></i>
                            <span>Venta Aprobada</span>
                            <small>La venta cumple con todos los requisitos</small>
                        </div>
                    </label>

                    <label class="result-option rejected">
                        <input type="radio" name="result" value="rejected">
                        <div class="result-content">
                            <i class="fas fa-times-circle"></i>
                            <span>Venta Rechazada</span>
                            <small>La venta no cumple con los requisitos</small>
                        </div>
                    </label>
                </div>
            </section>

            <!-- SECCIÓN 3: CHECKLIST DE CUMPLIMIENTO -->
            <section class="form-section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="section-title">
                        <h2>Checklist de Cumplimiento</h2>
                        <p>Evaluación de cada punto del proceso de venta</p>
                    </div>
                </div>

                <div class="checklist-grid">
                    <div class="checklist-item">
                        <label>
                            <i class="fas fa-handshake"></i>
                            1. Presentación adecuada
                        </label>
                        <div class="radio-group">
                            <label><input type="radio" name="item1" value="Sí"> Sí</label>
                            <label><input type="radio" name="item1" value="No"> No</label>
                            <label><input type="radio" name="item1" value="Parcial"> Parcial</label>
                        </div>
                    </div>

                    <div class="checklist-item">
                        <label>
                            <i class="fas fa-id-badge"></i>
                            2. Recolección adecuada de la información
                        </label>
                        <div class="radio-group">
                            <label><input type="radio" name="item2" value="Sí"> Sí</label>
                            <label><input type="radio" name="item2" value="No"> No</label>
                            <label><input type="radio" name="item2" value="Parcial"> Parcial</label>
                        </div>
                    </div>

                    <div class="checklist-item">
                        <label>
                            <i class="fas fa-box"></i>
                            3. Explicación del producto
                        </label>
                        <div class="radio-group">
                            <label><input type="radio" name="item3" value="Sí"> Sí</label>
                            <label><input type="radio" name="item3" value="No"> No</label>
                            <label><input type="radio" name="item3" value="Parcial"> Parcial</label>
                        </div>
                    </div>

                    <div class="checklist-item">
                        <label>
                            <i class="fas fa-file-contract"></i>
                            4. Condiciones claramente explicadas
                        </label>
                        <div class="radio-group">
                            <label><input type="radio" name="item4" value="Sí"> Sí</label>
                            <label><input type="radio" name="item4" value="No"> No</label>
                            <label><input type="radio" name="item4" value="Parcial"> Parcial</label>
                        </div>
                    </div>

                    <div class="checklist-item">
                        <label>
                            <i class="fas fa-signature"></i>
                            5. Consentimiento verbal o escrito obtenido
                        </label>
                        <div class="radio-group">
                            <label><input type="radio" name="item5" value="Sí"> Sí</label>
                            <label><input type="radio" name="item5" value="No"> No</label>
                            <label><input type="radio" name="item5" value="Parcial"> Parcial</label>
                        </div>
                    </div>

                    <div class="checklist-item">
                        <label>
                            <i class="fas fa-check-double"></i>
                            6. Cierre de venta correcto
                        </label>
                        <div class="radio-group">
                            <label><input type="radio" name="item6" value="Sí"> Sí</label>
                            <label><input type="radio" name="item6" value="No"> No</label>
                            <label><input type="radio" name="item6" value="Parcial"> Parcial</label>
                        </div>
                    </div>

                    <div class="checklist-item">
                        <label>
                            <i class="fas fa-comments"></i>
                            7. Lenguaje apropiado
                        </label>
                        <div class="radio-group">
                            <label><input type="radio" name="item7" value="Sí"> Sí</label>
                            <label><input type="radio" name="item7" value="No"> No</label>
                            <label><input type="radio" name="item7" value="Parcial"> Parcial</label>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECCIÓN 4: ERRORES CRÍTICOS -->
            <section class="form-section" id="seccionErrores">
                <div class="section-header">
                    <div class="section-icon error">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="section-title">
                        <h2>Errores Críticos</h2>
                        <p>Marcar si se identificaron errores graves (requerido si la venta es rechazada)</p>
                    </div>
                </div>

                <div class="error-list">
                    <label class="error-item">
                        <input type="checkbox" name="criticalError" value="No mencionó el período de prueba">
                        <span>No mencionó la información del agente</span>
                    </label>

                    <label class="error-item">
                        <input type="checkbox" name="criticalError" value="Omitió el precio total">
                        <span>Omitió información de costos del plan</span>
                    </label>

                    <label class="error-item">
                        <input type="checkbox" name="criticalError" value="Información engañosa sobre el producto">
                        <span>Información engañosa sobre el producto</span>
                    </label>

                    <label class="error-item">
                        <input type="checkbox" name="criticalError" value="No obtuvo consentimiento verbal claro">
                        <span>No obtuvo consentimiento verbal o escrito claro</span>
                    </label>

                    <label class="error-item">
                        <input type="checkbox" name="criticalError" value="Lenguaje inapropiado o agresivo">
                        <span>Lenguaje inapropiado o agresivo</span>
                    </label>
                </div>

                <div class="form-grid" style="margin-top: 20px;">
                    <div class="form-group">
                        <label for="minutoError">
                            <i class="far fa-clock"></i>
                            Minuto del Error
                        </label>
                        <input type="text" id="minutoError" name="errorMinute" placeholder="Ej: 03:45">
                    </div>

                    <div class="form-group full-width">
                        <label for="descripcionError">
                            <i class="fas fa-align-left"></i>
                            Descripción Detallada del Error
                        </label>
                        <textarea id="descripcionError" name="errorDescription" rows="3" placeholder="Describe el error crítico identificado..."></textarea>
                    </div>
                </div>
            </section>

            <!-- SECCIÓN 5: FEEDBACK ESTRUCTURADO -->
            <section class="form-section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="section-title">
                        <h2>Feedback Estructurado</h2>
                        <p>Retroalimentación constructiva para el asesor</p>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label for="hechoObservado">
                        <i class="fas fa-eye"></i>
                        Hecho Observado
                        <span class="required">*</span>
                    </label>
                    <textarea id="hechoObservado" name="observedFact" rows="4" placeholder="Describe objetivamente lo que observaste en la llamada/interacción..." required></textarea>
                    <small>Sé específico y objetivo. Ejemplo: "En el minuto 2:30, el asesor no mencionó el costo mensual del servicio."</small>
                </div>

                <div class="form-group full-width">
                    <label for="impacto">
                        <i class="fas fa-bolt"></i>
                        Impacto
                        <span class="required">*</span>
                    </label>
                    <textarea id="impacto" name="impact" rows="4" placeholder="¿Qué impacto tuvo esto en la venta o experiencia del cliente?" required></textarea>
                    <small>Explica las consecuencias. Ejemplo: "Esto puede generar confusión y afectar la confianza del cliente."</small>
                </div>

                <div class="form-group full-width">
                    <label for="accionEsperada">
                        <i class="fas fa-tasks"></i>
                        Acción Esperada
                        <span class="required">*</span>
                    </label>
                    <textarea id="accionEsperada" name="expectedAction" rows="4" placeholder="¿Qué acción o comportamiento se espera del asesor?" required></textarea>
                    <small>Sé claro y accionable. Ejemplo: "Mencionar siempre el precio completo antes de solicitar confirmación."</small>
                </div>

                <div class="form-group full-width">
                    <label for="buenasPracticas">
                        <i class="fas fa-star"></i>
                        Buenas Prácticas Identificadas
                    </label>
                    <textarea id="buenasPracticas" name="goodPractices" rows="3" placeholder="Reconoce aspectos positivos de la interacción..."></textarea>
                    <small>Opcional pero recomendado. Refuerza comportamientos positivos.</small>
                </div>
            </section>

            <!-- SECCIÓN 6: SEGUIMIENTO -->
            <section class="form-section">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="section-title">
                        <h2>Seguimiento</h2>
                        <p>Acciones y seguimiento requerido</p>
                    </div>
                </div>

                <div class="followup-list">
                    <label class="followup-item">
                        <input type="checkbox" name="followUp" value="Capacitación">
                        <div class="followup-content">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Requiere capacitación adicional</span>
                        </div>
                    </label>

                    <label class="followup-item">
                        <input type="checkbox" name="followUp" value="Revisión en 1 semana">
                        <div class="followup-content">
                            <i class="fas fa-calendar-check"></i>
                            <span>Revisión en 1 semana</span>
                        </div>
                    </label>

                    <label class="followup-item">
                        <input type="checkbox" name="followUp" value="Coaching individual">
                        <div class="followup-content">
                            <i class="fas fa-user-friends"></i>
                            <span>Coaching individual</span>
                        </div>
                    </label>

                    <label class="followup-item">
                        <input type="checkbox" name="followUp" value="Reconocimiento público">
                        <div class="followup-content">
                            <i class="fas fa-trophy"></i>
                            <span>Reconocimiento público</span>
                        </div>
                    </label>
                </div>

                <div class="form-group full-width" style="margin-top: 20px;">
                    <label for="conclusion">
                        <i class="fas fa-flag-checkered"></i>
                        Conclusión General
                    </label>
                    <textarea id="conclusion" name="conclusion" rows="4" placeholder="Resumen final de la evaluación y próximos pasos..."></textarea>
                </div>
            </section>

            <!-- BOTONES DE ACCIÓN -->
            <div class="form-actions">
                <button type="button" class="btn-secondary" onclick="guardarBorrador()">
                    <i class="fas fa-save"></i>
                    Guardar Borrador
                </button>
                <button type="submit" class="btn-primary">
                    <i class="fas fa-paper-plane"></i>
                    Enviar Evaluación
                </button>
            </div>
        </form>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/supabase_config.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/control_calidad.js"></script>
</body>
</html>